<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>初評価値計算機</title>
    <link rel="stylesheet" href="common.css">
</head>
<body>
    <div class="calculator">
        <h1>初評価値計算機</h1>
        <h4>最終試験前の値を入力してください</h4>
        <h6>バグなどの連絡はX:@Cet_svまでお願いします</h6>
        <div class="input-group">
            <label for="vo">Vo</label>
            <input type="number" id="vo" min="0" max="2000" value="0">
        </div>
        <div class="input-group">
            <label for="da">Da</label>
            <input type="number" id="da" min="0" max="2000" value="0">
        </div>
        <div class="input-group">
            <label for="vi">Vi</label>
            <input type="number" id="vi" min="0" max="2000" value="0">
        </div>
        <div class="input-group">
            <label for="rank">順位</label>
            <input type="number" id="rank" min="1" max="4" value="1">
        </div>
        <div class="input-group">
            <label for="max-status">ステータス上限</label>
            <input type="number" id="max-status" min="1000" max="1800" value="1800">
        </div>
        <div class="input-group">
            <label for="score">最終試験スコア</label>
            <input type="number" id="score" min="0" value="0">
        </div>
        <div class="result" id="result">評価値: 0 (C)</div>
    </div>

    <script>
        const inputs = document.querySelectorAll('input');
        const resultDiv = document.getElementById('result');

        function calculateBonus(rank) {
            switch (rank) {
                case 1: return { bonus: 30, add: 1700 };
                case 2: return { bonus: 20, add: 900 };
                case 3: return { bonus: 10, add: 500 };
                default: return { bonus: 0, add: 0 };
            }
        }

        function calculateScoreAdjustment(score) {
            let adjustment = 0;
            const thresholds = [5000, 5000, 10000, 10000, 10000];
            const multipliers = [0.3, 0.15, 0.08, 0.04, 0.02];

            thresholds.forEach((threshold, i) => {
                if (score > threshold) {
                    adjustment += threshold * multipliers[i];
                    score -= threshold;
                } else {
                    adjustment += score * multipliers[i];
                    score = 0;
                }
            });
            adjustment += score * 0.01;
            return adjustment;
        }

        function getGrade(result) {
            if (result < 4500) return "C";
            if (result < 6000) return "C+";
            if (result < 8000) return "B";
            if (result < 10000) return "B+";
            if (result < 11500) return "A";
            if (result < 13000) return "A+";
            if (result < 14500) return "S";
            if (result < 16000) return "S+";
            if (result < 18000) return "SS";
            return "SS+";
        }

        function calculate() {
            const vo = parseInt(document.getElementById('vo').value) || 0;
            const da = parseInt(document.getElementById('da').value) || 0;
            const vi = parseInt(document.getElementById('vi').value) || 0;
            const rank = parseInt(document.getElementById('rank').value) || 1;
            const maxStatus = parseInt(document.getElementById('max-status').value) || 1800;
            const score = parseInt(document.getElementById('score').value) || 0;

            const { bonus } = calculateBonus(rank);

            const adjustedVo = Math.min(vo + bonus, maxStatus);
            const adjustedDa = Math.min(da + bonus, maxStatus);
            const adjustedVi = Math.min(vi + bonus, maxStatus);

            const sum = adjustedVo + adjustedDa + adjustedVi;
            const A = sum * 2.3;
            const D = calculateScoreAdjustment(score);
            const finalScore = Math.ceil(A + D);

            resultDiv.innerHTML = `評価値: ${finalScore} (${getGrade(finalScore)})`;
        }

        inputs.forEach(input => input.addEventListener('input', calculate));
        calculate();
    </script>
</body>
</html>
