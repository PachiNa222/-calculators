<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NIA評価値計算機</title>
    <link rel="stylesheet" href="common.css">
</head>
<body>
    <div class="calculator">
        <h1>NIA評価値計算機</h1>
        <h4>最終試験前の値を入力してください</h4>
        <h6>親愛度20,FINALEを仮定しています<br>最大値は各ステータス上昇が最大の場合の値です<br>バグなどの連絡はX:@Cet_svまでお願いします</h6>

        <div class="input-group">
            <label>1番目に得意なステータスのボーナス</label>
            <input type="number" id="bonus1" min="0" max="2000" value="0">
        </div>
        <div class="input-group">
            <label>2番目に得意なステータスのボーナス</label>
            <input type="number" id="bonus2" min="0" max="2000" value="0">
        </div>
        <div class="input-group">
            <label>3番目に得意なステータスのボーナス</label>
            <input type="number" id="bonus3" min="0" max="2000" value="0">
        </div>
        <div class="input-group">
            <label>Vo</label>
            <input type="number" id="vo" min="0" max="2000" value="0">
        </div>
        <div class="input-group">
            <label>Da</label>
            <input type="number" id="da" min="0" max="2000" value="0">
        </div>
        <div class="input-group">
            <label>Vi</label>
            <input type="number" id="vi" min="0" max="2000" value="0">
        </div>
        <div class="input-group">
            <label>ファン投票数</label>
            <input type="number" id="votes" min="0" value="0">
        </div>
        <div class="input-group">
            <label>最終試験スコア</label>
            <input type="number" id="score" min="0" value="0">
        </div>

        <div class="result" id="result">最低値: 0 (C)<br>最大値: 0 (C)</div>
    </div>

    <script>
        document.querySelectorAll('input').forEach(input => input.addEventListener('input', calculate));

        function calculate() {
            const get = id => parseInt(document.getElementById(id).value) || 0;
            const [b1, b2, b3, vo, da, vi, votes, score] = [
                get('bonus1'), get('bonus2'), get('bonus3'), get('vo'), get('da'), get('vi'), get('votes'), get('score')
            ];

            const sum = vo + da + vi;
            const bonuses = [1 + b1 / 100, 1 + b2 / 100, 1 + b3 / 100];
            const maxBonus = 172 * bonuses[0] + 142 * bonuses[1] + 116 * bonuses[2];
            const avgBonus = 172 * bonuses[0] + 88 * bonuses[1] + 43 * bonuses[2];
            const [A, E, F] = [sum * 2.3, (sum + maxBonus) * 2.3, (sum + avgBonus) * 2.3];

            const B = votes < 200000 ? votes * 0.16 + 3250 : votes * 0.004787 + 34179;
            let C = score + B, D = 0;

            [[20000, 0.1], [20000, 0.085], [20000, 0.07], [20000, 0.065], [20000, 0.06], [Infinity, 0.055]].forEach(([limit, rate]) => {
                if (C > 0) {
                    const part = Math.min(C, limit);
                    D += part * rate;
                    C -= part;
                }
            });

            const results = [Math.ceil(A + D), Math.ceil(F + D), Math.ceil(E + D)];
            const grades = results.map(r => r < 4500 ? "C" : r < 6000 ? "C+" : r < 8000 ? "B" : r < 10000 ? "B+" : r < 11500 ? "A" : r < 13000 ? "A+" : r < 14500 ? "S" : r < 16000 ? "S+" : r < 18000 ? "SS" : "SS+");

            document.getElementById('result').innerHTML = `最小値 : ${results[0]} (${grades[0]})<br>予測値 : ${results[1]} (${grades[1]})<br>最大値 : ${results[2]} (${grades[2]})`;
        }

        calculate();
    </script>
</body>
</html>
